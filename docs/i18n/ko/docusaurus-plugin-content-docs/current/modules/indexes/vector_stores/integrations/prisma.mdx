# Prisma

Langchain은 PostgreSQL 데이터베이스에서 벡터 검색을 위해 [Prisma](https://www.prisma.io/)와 PostgreSQL 그리고 [`pgvector`](https://github.com/pgvector/pgvector) Postgres 확장 기능을 함께 사용하는 것을 지원합니다.

## 준비

### Supabase를 사용하여 데이터베이스 인스턴스 설정

Supabase와 Prisma로 새 데이터베이스 인스턴스를 설정하려면 [Prisma와 Supabase 통합 가이드](https://supabase.com/docs/guides/integrations/prisma)를 참고하세요.

### Prisma 설치

```bash npm2yarn
npm install prisma
```

### `docker-compose`로 `pgvector` 셀프 호스팅 인스턴스 설정

`pgvector`는 미리 빌드된 도커 이미지를 제공하여 쉽게 자체 호스팅 Postgres 인스턴스를 설정할 수 있습니다.

```yaml
services:
  db:
    image: ankane/pgvector
    ports:
      - 5432:5432
    volumes:
      - db:/var/lib/postgresql/data
    environment:
      - POSTGRES_PASSWORD=
      - POSTGRES_USER=
      - POSTGRES_DB=

volumes:
  db:
```

### 새로운 스키마 생성

아직 스키마를 생성하지 않았다고 가정하고, Unsupported("vector") 유형의 vector 필드를 가진 새로운 모델을 생성하세요.:

```prisma
model Document {
  id      String                 @id @default(cuid())
  content String
  vector  Unsupported("vector")?
}
```

그 후, 직접 마이그레이션을 실행하지 않도록 `--create-only` 옵션을 사용하여 새로운 마이그레이션을 생성하세요.

```bash npm2yarn
npm run prisma migrate dev --create-only
```

아직 pgvector 확장이 활성화되지 않았다면, 새로 생성된 마이그레이션에 다음 줄을 추가하여 pgvector 확장을 활성화하세요.:

```sql
CREATE EXTENSION IF NOT EXISTS vector;
```

그런 다음 마이그레이션을 실행합니다:

```bash npm2yarn
npm run prisma migrate dev
```

## 사용 방법

import CodeBlock from "@theme/CodeBlock";
import Example from "@examples/indexes/vector_stores/prisma_vectorstore/prisma.ts";
import Schema from "@examples/indexes/vector_stores/prisma_vectorstore/prisma/schema.prisma";

'withModel' 메소드를 사용하여 `metadata' 필드에 대한 적절한 타입 추론을 얻습니다:

<CodeBlock language="typescript">{Example}</CodeBlock>

위의 샘플은 다음 스키마를 사용합니다:

<CodeBlock language="prisma">{Schema}</CodeBlock>
