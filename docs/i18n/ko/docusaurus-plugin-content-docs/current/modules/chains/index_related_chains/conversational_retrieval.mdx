import CodeBlock from "@theme/CodeBlock";
import ConvoRetrievalQAExample from "@examples/chains/conversational_qa.ts";

# `ConversationalRetrievalQAChain`

`ConversationalRetrievalQA`체인은`RetrievalQAChain`을 기반으로 채팅 기록 구성 요소를 제공합니다.

여기에는 질문과 채팅 기록이라는 두 가지 입력이 필요합니다.

먼저 채팅 기록과 질문을 독립형 질문으로 결합한 다음 검색기에서 관련 문서를 조회한 다음 해당 문서와 질문을 질문 답변 체인에 전달하여 응답을 반환합니다.

검색기 하나를 만들려면 Retrieval가 필요합니다. 아래 예에서는 임베딩으로 만들 수 있는 vectorStore에서 Retrieval를 만들겠습니다.

import Example from "@examples/chains/conversational_qa.ts";

<CodeBlock language="typescript">{ConvoRetrievalQAExample}</CodeBlock>

이 코드 스니펫에서
`ConversationalRetrievalQAChain` 클래스의 fromLLM 메서드는 다음과 같은 서명을 가집니다:

```typescript
static fromLLM(
  llm: BaseLanguageModel,
  retriever: BaseRetriever,
  options?: {
    questionGeneratorTemplate?: string;
    qaTemplate?: string;
    returnSourceDocuments?: boolean;
  }
): ChatVectorDBQAChain
```

다음은 옵션 객체의 각 속성에 대한 설명입니다:

- `questionGeneratorTemplate`: 질문 생성 템플릿을 지정하는 문자열입니다. 이 템플릿을 제공하면 `ConversationalRetrievalQAChain`은 question 매개변수에 제공된 질문을 사용하는 대신 이 템플릿을 사용하여 대화 컨텍스트에서 질문을 생성합니다. 이는 원래 질문에 적절한 답변을 검색하기에 충분한 정보가 포함되어 있지 않은 경우에 유용할 수 있습니다.
- `qaTemplate`: 응답 템플릿을 지정하는 문자열입니다. 제공된 경우 `ConversationalRetrievalQAChain`은 결과를 반환하기 전에 이 템플릿을 사용하여 응답의 형식을 지정합니다. 최종 사용자에게 응답이 표시되는 방식을 사용자 지정하려는 경우 유용할 수 있습니다.
- `returnSourceDocuments`: 대화형 검색 쿼리 체인`이 답변을 검색하는 데 사용된 소스 문서를 반환할지 여부를 나타내는 Boolean 값입니다. true로 설정하면 호출() 메서드가 반환하는 결과에 문서가 포함됩니다. 사용자가 답을 생성하는 데 사용된 소스를 볼 수 있도록 하려는 경우 유용할 수 있습니다. 설정하지 않으면 기본값은 false가 됩니다.

요약하면, `questionGeneratorTemplate`, `qaTemplate`, `returnSourceDocuments` 옵션을 통해 사용자는 `ConversationalRetrievalQAChain`의 동작을 사용자 정의할 수 있습니다.
